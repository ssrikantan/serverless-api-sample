MIME-Version: 1.0
Date: Sun, 12 Aug 2018 22:02:58 +0530
From: Srikantan Sankaran <sansri@microsoft.com>
Subject: FW: Using Azure Functions, Cosmos DB and Powerapps to build,
 deploy and consume Serverless Apps
Thread-Topic: FW: Using Azure Functions, Cosmos DB and Powerapps to build,
 deploy and consume Serverless Apps
To: "s_srikantan@hotmail.com" <s_srikantan@hotmail.com>
Content-Transfer-Encoding: quoted-printable
Content-Type: text/html; charset="utf-8"

<html xmlns:v=3D"urn:schemas-microsoft-com:vml" xmlns:o=3D"urn:schemas-micr=
osoft-com:office:office" xmlns:w=3D"urn:schemas-microsoft-com:office:word" =
xmlns:m=3D"http://schemas.microsoft.com/office/2004/12/omml" xmlns=3D"http:=
//www.w3.org/TR/REC-html40">
<head>
<meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3Dutf-8">
<meta name=3D"Generator" content=3D"Microsoft Word 15 (filtered medium)">
<base href=3D"https://blogs.msdn.microsoft.com/srikantan/feed/"><!--[if !ms=
o]><style>v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style><![endif]--><style><!--
/* Font Definitions */
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
p.msonormal0, li.msonormal0, div.msonormal0
	{mso-style-name:msonormal;
	mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
span.EmailStyle21
	{mso-style-type:personal-reply;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
/* List Definitions */
@list l0
	{mso-list-id:925070917;
	mso-list-template-ids:545187612;}
@list l1
	{mso-list-id:1509447267;
	mso-list-template-ids:-1059693698;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:=EF=82=B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l1:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
@list l1:level3
	{mso-level-number-format:bullet;
	mso-level-text:=EF=82=A7;
	mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l1:level4
	{mso-level-number-format:bullet;
	mso-level-text:=EF=82=A7;
	mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l1:level5
	{mso-level-number-format:bullet;
	mso-level-text:=EF=82=A7;
	mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l1:level6
	{mso-level-number-format:bullet;
	mso-level-text:=EF=82=A7;
	mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l1:level7
	{mso-level-number-format:bullet;
	mso-level-text:=EF=82=A7;
	mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l1:level8
	{mso-level-number-format:bullet;
	mso-level-text:=EF=82=A7;
	mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l1:level9
	{mso-level-number-format:bullet;
	mso-level-text:=EF=82=A7;
	mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
--></style><!--[if gte mso 9]><xml>
<o:shapedefaults v:ext=3D"edit" spidmax=3D"1026" />
</xml><![endif]--><!--[if gte mso 9]><xml>
<o:shapelayout v:ext=3D"edit">
<o:idmap v:ext=3D"edit" data=3D"1" />
</o:shapelayout></xml><![endif]-->
</head>
<body lang=3D"EN-IN" link=3D"blue" vlink=3D"purple">
<div class=3D"WordSection1">
<p class=3D"MsoNormal"><span style=3D"mso-fareast-language:EN-US"><o:p>&nbs=
p;</o:p></span></p>
<p class=3D"MsoNormal"><span style=3D"mso-fareast-language:EN-US"><o:p>&nbs=
p;</o:p></span></p>
<div>
<div style=3D"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in =
0in 0in">
<p class=3D"MsoNormal"><b><span lang=3D"EN-US">Feed:</span></b><span lang=
=3D"EN-US"> Srikantan's Blog<br>
<b>Posted on:</b> Saturday, July 22, 2017 10:16 PM<br>
<b>Author:</b> Srikantan Sankaran<br>
<b>Subject:</b> Using Azure Functions, Cosmos DB and Powerapps to build, de=
ploy and consume Serverless Apps<o:p></o:p></span></p>
</div>
</div>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<table class=3D"MsoNormalTable" border=3D"0" cellspacing=3D"4" cellpadding=
=3D"0">
<tbody>
<tr>
<td style=3D"padding:.75pt .75pt .75pt .75pt">
<p>Azure Functions can be used to quickly build Application as Micro Servic=
es, complete with turnkey integration with other Azure Services like Cosmos=
 DB, Queues, Blobs, etc , through the use of Input and output Bindings. Inb=
uilt tools can be used to generate
 Swagger definitions for these Services, publish them and consume them in C=
lient side Applications running across device platforms.<o:p></o:p></p>
<p>In this article , an Azure Function App comprising of 2 different Functi=
ons that perform CRUD operations on data residing in Azure Cosmos DB, will =
be created. The Function App would be exposed as a REST callable endpoint t=
hat would be consumed by a Microsoft
 Powerapps Application. This use case does not require an IDE for developme=
nt. It can be built entirely from the Azure Portal and the browser.<o:p></o=
:p></p>
<p>[The Powerapps App file, C# Script files, Yaml file for the Open API Spe=
cs created for this article can be downloaded from this Gtihub location
<a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3A%2=
F%2Fgithub.com%2Fssrikantan%2Fserverlessapisample&amp;data=3D02%7C01%7C%7Cd=
28778285a4f4951a1ad08d6007142a3%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%=
7C636696883781088794&amp;sdata=3D8hPvx0b4Y3%2F1yMvG0ZvZ%2FUDGu1OJmy7enDzsWR=
Ql5eI%3D&amp;reserved=3D0" originalsrc=3D"https://github.com/ssrikantan/ser=
verlessapisample" shash=3D"FK7HobU6WzPcydwQx8xhfHvQQKQoiKXCXFQkSi1k&#43;HGs=
oBKyRMq56gr64OYW1wLvPZwU4PJ7MRbu4B/ypeigBptfetlFjv2K/yUas0PCx6AXBE5QnABVLzD=
KhMnrzNpPwQ1jg4jbR737eOnuVZPRrvMm6pItHIDLstzeuCLcV1g=3D">
here</a>]<o:p></o:p></p>
<ol start=3D"1" type=3D"1">
<li class=3D"MsoNormal" style=3D"mso-margin-top-alt:auto;mso-margin-bottom-=
alt:auto;mso-list:l0 level1 lfo1">
<em><span style=3D"font-family:&quot;Calibri&quot;,sans-serif">Creation of =
a DocumentDB database in Azure Cosmos DB</span></em><o:p></o:p></li></ol>
<p>Use the Azure portal to create a DocumentDB database. For the use case d=
escribed in this article, created is a Collection (<em><span style=3D"font-=
family:&quot;Calibri&quot;,sans-serif">expensescol</span></em>) that stores=
 Project Expense details, comprising the attributes
 shown below.<o:p></o:p></p>
<p><a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3=
A%2F%2Fmsdnshared.blob.core.windows.net%2Fmedia%2F2017%2F07%2Fcosmodb.jpg&a=
mp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C84df9e7fe9f640afb=
435aaaaaaaaaaaa%7C1%7C0%7C636696883781088794&amp;sdata=3Dxo9W6TpaRZodxCb0VI=
wCyjgHn7v4gwEgiFDzpZQa2HU%3D&amp;reserved=3D0" originalsrc=3D"https://msdns=
hared.blob.core.windows.net/media/2017/07/cosmodb.jpg" shash=3D"0AFk9iG1gMH=
YAX0tXRblnLj2dNiOwEL1Fe4SwC1QOUEhhy1C&#43;QlKXLYjpr9uXLeKJiz2YNhIxW68SDsZ0e=
yFWEUob0KE5&#43;kEWqjyovFfdINyOGlj4RMq5i402T5XiSrqZjpP5oaDetznATR&#43;B0HiG=
o9Z/gQac83VOX&#43;wbkiRlIc=3D"><span style=3D"text-decoration:none"><img bo=
rder=3D"0" width=3D"470" height=3D"217" style=3D"width:4.8958in;height:2.26=
04in" id=3D"_x0000_i1025" src=3D"https://msdnshared.blob.core.windows.net/m=
edia/2017/07/cosmodb.jpg"></span></a><o:p></o:p></p>
<p>2<em><span style=3D"font-family:&quot;Calibri&quot;,sans-serif">. Creati=
on of a Function App that implements the Business Logic in Service</span></=
em><o:p></o:p></p>
<p>Two Functions are created in this Function App using C# Scripts.<o:p></o=
:p></p>
<ul type=3D"disc">
<li class=3D"MsoNormal" style=3D"mso-margin-top-alt:auto;mso-margin-bottom-=
alt:auto;mso-list:l1 level1 lfo2">
<em><span style=3D"font-family:&quot;Calibri&quot;,sans-serif">GetAllProjec=
tExpenses</span></em> that returns all the Project Expenses Data from the c=
ollection in Cosmos DB<o:p></o:p></li><li class=3D"MsoNormal" style=3D"mso-=
margin-top-alt:auto;mso-margin-bottom-alt:auto;mso-list:l1 level1 lfo2">
<em><span style=3D"font-family:&quot;Calibri&quot;,sans-serif">CreateProjec=
tExpense</span></em> that creates a Project Expense Record in Cosmos DB<o:p=
></o:p></li></ul>
<p>a) Function <em><span style=3D"font-family:&quot;Calibri&quot;,sans-seri=
f">GetAllProjectExpenses</span></em> -&gt;<o:p></o:p></p>
<p>The Input and output Binding configured for this Function:<o:p></o:p></p=
>
<p><a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3=
A%2F%2Fmsdnshared.blob.core.windows.net%2Fmedia%2F2017%2F07%2Fbindings1.jpg=
&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C84df9e7fe9f640a=
fb435aaaaaaaaaaaa%7C1%7C0%7C636696883781088794&amp;sdata=3DC3d0hkvC%2FBAEiv=
4jnAnDgbla8IJrDeP7HcGpy27OAV4%3D&amp;reserved=3D0" originalsrc=3D"https://m=
sdnshared.blob.core.windows.net/media/2017/07/bindings1.jpg" shash=3D"IetgO=
LD696KXajNM1MdniQeIyWihZ9meT/l8YGxX&#43;H1C6z4BddDsNjuy6DKN4MkkGAKPrtP6OG6I=
i50ol5/RrdWcxIYQVyJ2v0v&#43;eK3yXKHpHPwEv9oKPX0vj9dUJuLO/09WL8qPvlsCImK&#43=
;mZb0JRXhQqIn03UmV2TTOl4yPOU=3D"><span style=3D"text-decoration:none"><img =
border=3D"0" width=3D"684" height=3D"332" style=3D"width:7.1197in;height:3.=
4583in" id=3D"_x0000_i1026" src=3D"https://msdnshared.blob.core.windows.net=
/media/2017/07/bindings1.jpg"></span></a><o:p></o:p></p>
<p>Apart from the HTTPTrigger input binding for the incoming request, an ad=
ditional input binding for Cosmos DB&nbsp; is configured that retrieves all=
 the Expense records from the database. Due to this binding, all the Expens=
e records are available to the Run Method
 through the '<em><span style=3D"font-family:&quot;Calibri&quot;,sans-serif=
">documents</span></em>' input parameter - see screenshot of the C# Script =
used in this Function, below.<o:p></o:p></p>
<p><a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3=
A%2F%2Fmsdnshared.blob.core.windows.net%2Fmedia%2F2017%2F07%2FGetAppExpense=
sRequest.jpg&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C84d=
f9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636696883781088794&amp;sdata=3DXuP8=
7o%2FpQl2WMeOEElfF6K72P51XppsjUqORUySdfF4%3D&amp;reserved=3D0" originalsrc=
=3D"https://msdnshared.blob.core.windows.net/media/2017/07/GetAppExpensesRe=
quest.jpg" shash=3D"Pn/W3Lble8gUqZ4aH3uIIUCiy0EdSGVztO4ySP0oNXlR5Lvqpm89ZGv=
ODzyduuBmjAPRuc&#43;wlh8L/NyeUr44xpbKPhUP6dW9QPGNQGbwY3lW5eUXGKHySdSkownSZq=
VVM3o9xkEnFsyomRE7De2BnKjJA1QcM/NCgC41WDujFhY=3D"><span style=3D"text-decor=
ation:none"><img border=3D"0" width=3D"572" height=3D"163" style=3D"width:5=
.9531in;height:1.6979in" id=3D"_x0000_i1027" src=3D"https://msdnshared.blob=
.core.windows.net/media/2017/07/GetAppExpensesRequest.jpg"></span></a><o:p>=
</o:p></p>
<p>[Note: The scripts provided here are only meant to illustrate the point,=
 and do not handle best practices, Exceptions, etc]<o:p></o:p></p>
<p>Refer to the Azure Documentation for detailed guidance on configuring Bi=
ndings in Azure Functions, for
<a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3A%2=
F%2Fdocs.microsoft.com%2Fen-us%2Fazure%2Fazure-functions%2Ffunctions-bindin=
gs-http-webhook&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C=
84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636696883781088794&amp;sdata=3Dv=
kWUCIkjbfVeJOzyLJWg0c3vUwtJ%2FEBT3PKA5LwB%2FE4%3D&amp;reserved=3D0" origina=
lsrc=3D"https://docs.microsoft.com/en-us/azure/azure-functions/functions-bi=
ndings-http-webhook" shash=3D"tV2H3RwSQ6OljJ5DLqKnNtxhgjgFmucDbgvP6EQ0LD7ML=
FDzjL6vACB9Jhm6eCEvibgR8P1Uj25cJ1Hq5FkIq1ZOsTCALvABba3pvou8gdtY9kwVJpwwu7yS=
ZRtOIpwmhx5R9pStCDM7STFCwaQhdTyKw54gAW4f2UiA1Iby3oY=3D">
HTTPTriggers </a>and Azure <a href=3D"https://eur01.safelinks.protection.ou=
tlook.com/?url=3Dhttps%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fazure%2Fazure-f=
unctions%2Ffunctions-integrate-store-unstructured-data-cosmosdb&amp;data=3D=
02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C84df9e7fe9f640afb435aaaaaaa=
aaaaa%7C1%7C0%7C636696883781245049&amp;sdata=3D6dUWmxf10g71Qc1SQVbdHW1UhFSH=
32cllbTS0fyA5ks%3D&amp;reserved=3D0" originalsrc=3D"https://docs.microsoft.=
com/en-us/azure/azure-functions/functions-integrate-store-unstructured-data=
-cosmosdb" shash=3D"VhgphopteF8ihSpXnei2XBwWgpxMlMSIBm01dsOj8v4yE&#43;25Une=
xC91PNhrKYHo9P3LAk/gXoI59vPLXVuhBFJqsMOaLWIZGjBbGEWYoJ9o3k3VpanghjhrKTD1Qp0=
uFGwjF&#43;nAp4J9VWiCLt96TJWS8CfBmRecL2cXo0bvaqBo=3D">
CosmosDB </a><o:p></o:p></p>
<p>b) Function <em><span style=3D"font-family:&quot;Calibri&quot;,sans-seri=
f">CreateProjectExpense</span></em> -&gt;<o:p></o:p></p>
<p>The binding configuration used for this Function is:<o:p></o:p></p>
<p><a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3=
A%2F%2Fmsdnshared.blob.core.windows.net%2Fmedia%2F2017%2F07%2FBindingForCre=
ateExpense.jpg&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C8=
4df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636696883781245049&amp;sdata=3DnT=
ojMKqSdTSLtt6pCjs3aB%2BhrObWmbEAHLx9EyPCtPE%3D&amp;reserved=3D0" originalsr=
c=3D"https://msdnshared.blob.core.windows.net/media/2017/07/BindingForCreat=
eExpense.jpg" shash=3D"kyf/F6JE/1E7/ywrVy5AYT42Ldl0wBr08sCbH7ba655zeQ0Vgcch=
W8kMlOyCg9bmi4ofxPIWxuyPejBSwf5kquCFV3&#43;/yImv6K4jaDo4KAyvxCQPm9wZdjmTWz3=
b/k0cqUVEQSvQTiaDLhhmqeqlZ/TeiusHJeVpROHlE8dnc4o=3D"><span style=3D"text-de=
coration:none"><img border=3D"0" width=3D"282" height=3D"355" style=3D"widt=
h:2.9375in;height:3.6979in" id=3D"_x0000_i1028" src=3D"https://msdnshared.b=
lob.core.windows.net/media/2017/07/BindingForCreateExpense.jpg"></span></a>=
<o:p></o:p></p>
<p>Notice that there are 2 output bindings here, one for the HttpResponse a=
nd the other is the binding to Cosmos DB to insert the expense record into =
it.<o:p></o:p></p>
<p>[<strong><span style=3D"font-family:&quot;Calibri&quot;,sans-serif">Note=
:</span></strong> <em>
<span style=3D"font-family:&quot;Calibri&quot;,sans-serif">When the Run met=
hod in&nbsp; a Function is invoked asynchronously, we cannot use an 'out' p=
arameter to the Cosmos DB Binding
</span></em><strong><i><span style=3D"font-family:&quot;Calibri&quot;,sans-=
serif">and </span>
</i></strong><em><span style=3D"font-family:&quot;Calibri&quot;,sans-serif"=
>an</span></em><strong><i><span style=3D"font-family:&quot;Calibri&quot;,sa=
ns-serif">
</span></i></strong><em><span style=3D"font-family:&quot;Calibri&quot;,sans=
-serif">'out' for the HttpResponse in it. In such cases, we need to add the=
 document meant for insertion into an IAsyncCollector Object reference, 'co=
llector' in this case. Note that the&nbsp; parameter
 'collector' is used in the output binding to Cosmos DB, shown above</span>=
</em><strong><i><span style=3D"font-family:&quot;Calibri&quot;,sans-serif">=
 .
</span></i></strong>Refer to the documentation <a href=3D"https://eur01.saf=
elinks.protection.outlook.com/?url=3Dhttps%3A%2F%2Fdocs.microsoft.com%2Fen-=
us%2Fazure%2Fazure-functions%2Ffunctions-reference-csharp&amp;data=3D02%7C0=
1%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C84df9e7fe9f640afb435aaaaaaaaaaaa%=
7C1%7C0%7C636696883781245049&amp;sdata=3DXp%2ByvEUS9t%2F9B4uS8Rqxy0HQ1dMvaf=
H2aY92AYa0I18%3D&amp;reserved=3D0" originalsrc=3D"https://docs.microsoft.co=
m/en-us/azure/azure-functions/functions-reference-csharp" shash=3D"mM4Gy7q0=
jUQabVBS89HcXJ/KU6QhIl//EuYZQZ8OQHxx00aUrbQiVIayCYYMMNNlVhhGBw6kPpER1ji&#43=
;ke&#43;nY72mVgUoJ7r4DlR8BVYGrVCHzGOBDVtPOC&#43;rVl&#43;68JNy20Fv/2nKq/Q3pS=
PPTDBpBaoVm/yFxGyp90HiX716IyM=3D">
here </a>for more info pertaining to scenarios with multiple output paramet=
ers]<o:p></o:p></p>
<p><a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3=
A%2F%2Fmsdnshared.blob.core.windows.net%2Fmedia%2F2017%2F07%2FCreateProject=
Requests2.jpg&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C84=
df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636696883781245049&amp;sdata=3D%2B=
y0C0XQFV5%2F4HTcHumTKImW0caPhS2inwtT54JsCFw8%3D&amp;reserved=3D0" originals=
rc=3D"https://msdnshared.blob.core.windows.net/media/2017/07/CreateProjectR=
equests2.jpg" shash=3D"p78wdJgqO2&#43;u6LQnEllkjiu/CoeFd5A6Lo7C3XJ9AW68DYC1=
B4&#43;VHDQ9/quAeEqVh&#43;KT05SH1AA0yXu1gIW3Qgc7Pmn&#43;h/r19skqd1zWLbw3qHk=
d7dPtrPpuyfqlArgyTtLHuCEq/mmBIgxRMqStC4wJ7dcPV3OC1SSAqitKPTM=3D"><span styl=
e=3D"text-decoration:none"><img border=3D"0" width=3D"547" height=3D"397" s=
tyle=3D"width:5.6927in;height:4.1354in" id=3D"_x0000_i1029" src=3D"https://=
msdnshared.blob.core.windows.net/media/2017/07/CreateProjectRequests2.jpg">=
</span></a><o:p></o:p></p>
<p>3. <em><span style=3D"font-family:&quot;Calibri&quot;,sans-serif">Test t=
he Functions created&nbsp;</span></em><o:p></o:p></p>
<p>Use Postman to ensure both the Functions work without errors. The HttpTr=
igger Url can be obtained from the C# Script Editor View of the Function<o:=
p></o:p></p>
<p><a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3=
A%2F%2Fmsdnshared.blob.core.windows.net%2Fmedia%2F2017%2F07%2Fpostman31.jpg=
&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C84df9e7fe9f640a=
fb435aaaaaaaaaaaa%7C1%7C0%7C636696883781245049&amp;sdata=3D9O7eARlZmESytmnk=
KY7qvYdCsIWaRyKASjWNf7bY4YU%3D&amp;reserved=3D0" originalsrc=3D"https://msd=
nshared.blob.core.windows.net/media/2017/07/postman31.jpg" shash=3D"bD5LHO5=
0ymKQ8/CG0&#43;Yo07FexREujgLm01QaAMmmLpNi3hjOlPss//ivn4FD6AtbIGNdkEtvlzWJCL=
bqDpPLMkKuBBQq0SQ6e6Lqgyke2E3HXnvQBzle/ONYImfXhm0r5Hil7lr0zPuafBDI7TsJAyAjW=
1Dc5a&#43;Qjog7Wcpqgrc=3D"><span style=3D"text-decoration:none"><img border=
=3D"0" width=3D"1280" height=3D"720" style=3D"width:13.3333in;height:7.5in"=
 id=3D"_x0000_i1030" src=3D"https://msdnshared.blob.core.windows.net/media/=
2017/07/postman31.jpg"></span></a><o:p></o:p></p>
<p>4. <em><span style=3D"font-family:&quot;Calibri&quot;,sans-serif">Genera=
ting an OpenAPI (Swagger) Definition for the Function App</span></em><o:p><=
/o:p></p>
<p>A Function App could contain different Functions, each of which could po=
tentially be written in different programming languages. All of these Funct=
ions or individual 'Micro Services' could be exposed through a single base =
end point that represents the Function
 App. From the Application Settings, navigate to the 'API Endpoint' Tab.<o:=
p></o:p></p>
<p>Click on the button 'Generate API definition template' to generate a bas=
e definition of the Swagger. But it lacks all the elements required to full=
y describe the Functions. The definition, described in Yaml format, has to =
be manually edited in the editor
 pane. The Yaml file created for this Function is available along with the =
other artefacts in this blog Post.<o:p></o:p></p>
<p><a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3=
A%2F%2Fmsdnshared.blob.core.windows.net%2Fmedia%2F2017%2F07%2FOpenApiDefini=
tion1.jpg&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C84df9e=
7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636696883781245049&amp;sdata=3DNBqVBa4=
h5jURPfaL1gy7E6vHbqtHHcY0gGLKXK1DT6M%3D&amp;reserved=3D0" originalsrc=3D"ht=
tps://msdnshared.blob.core.windows.net/media/2017/07/OpenApiDefinition1.jpg=
" shash=3D"JbktmkfzfQ/Rghylko5pTcvdN17EQ8GlNnjyffjF78CMT0tZvYK28d2GuenexTfS=
hue2rlHLaIRkDRApIaXIZQwNVHg60cPzfwwcfIULpz5LkKwKYh0vVvPne4mdEDb9f676/tFngif=
Qa4GnBfm1BCp&#43;XkQiYMZDBYJYOLN02YI=3D"><span style=3D"text-decoration:non=
e"><img border=3D"0" width=3D"2616" height=3D"1454" style=3D"width:27.25in;=
height:15.1458in" id=3D"_x0000_i1031" src=3D"https://msdnshared.blob.core.w=
indows.net/media/2017/07/OpenApiDefinition1.jpg"></span></a><o:p></o:p></p>
<p>Refer to <a href=3D"https://eur01.safelinks.protection.outlook.com/?url=
=3Dhttps%3A%2F%2Fdocs.microsoft.com%2Fen-in%2Fazure%2Fazure-functions%2Ffun=
ctions-api-definition-getting-started&amp;data=3D02%7C01%7C%7Cd28778285a4f4=
951a1ad08d6007142a3%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C6366968837=
81245049&amp;sdata=3DbHXUsAugbi8ifeeAZJt6oQxPEtE575QUIp2cLT5NNKg%3D&amp;res=
erved=3D0" originalsrc=3D"https://docs.microsoft.com/en-in/azure/azure-func=
tions/functions-api-definition-getting-started" shash=3D"LoZP4POqYPXJtMp2WJ=
6vQHqKyNcPpd6HjDXsEtTwbWJ4JdM40kCmduaWx8OlRq84yDLjcCj40rvDDmcIdo0RYb8Y4HMQt=
VHqw7Uo9fW29MXXRdC9L1NhjrKs5CTMoqEQGLh2f2oGPZYZDVmTNLyXa3rOEfSkFBPL5x56uAL1=
GeA=3D">
this </a>, <a href=3D"https://eur01.safelinks.protection.outlook.com/?url=
=3Dhttps%3A%2F%2Fblogs.msdn.microsoft.com%2Fappserviceteam%2F2017%2F03%2F30=
%2Fannouncing-functions-swagger-support%2F&amp;data=3D02%7C01%7C%7Cd2877828=
5a4f4951a1ad08d6007142a3%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C63669=
6883781245049&amp;sdata=3DtSY8TjWw6JvEotaWgp9QuZNjrmiiVrYbg0hDFrPeDv4%3D&am=
p;reserved=3D0" originalsrc=3D"https://blogs.msdn.microsoft.com/appservicet=
eam/2017/03/30/announcing-functions-swagger-support/" shash=3D"HhHa8hxvJLRW=
jGjuJgorSCIyP&#43;hoKkfBYeK2w6TuX/XRUKAL0obAdG2qjDW7foVFrp81MIFNkwb1qx&#43;=
3rUG4wG8HcOUvq8YL2cxPvB3Y2j&#43;k8nWcuJhuiggxZcMDqP2SnFdaG8RqLFLsxQKsya24Bt=
6Fe0eKMcSDnyH1kikjUJ8=3D">
this&nbsp;</a> and <a href=3D"https://eur01.safelinks.protection.outlook.co=
m/?url=3Dhttps%3A%2F%2Fblog.kloud.com.au%2F2017%2F06%2F13%2Fazure-functions=
-with-swagger%2F&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7=
C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636696883781245049&amp;sdata=3D=
xo4yUoRF97Jes2HVfvoa5DHbD40Tz7pib5ouuKYRPOM%3D&amp;reserved=3D0" originalsr=
c=3D"https://blog.kloud.com.au/2017/06/13/azure-functions-with-swagger/" sh=
ash=3D"DZkXV5DXdjKe/RxgTXjQi&#43;ITm0qVoi5UrKRDxc/w8QWMQvEwq5T46f0wA1/3MqDE=
449pAGA81/txFFd0eLofRs2jzWT9XBud8hIdJoXhgKkfpjaZO9yOsiJSKsPMiWaKZ7q61NS7Xdk=
xEmYfjvip8dugRR6GDt9gm5l&#43;qFZehzY=3D">
this </a>links that provides guidance on working with Yaml to create the Sw=
agger definitions, or using other options to create it.<o:p></o:p></p>
<p>[Note: The samples considered in the links above use simple primitive ty=
pes as parameters in the Method calls. The scenario in this article however=
 deals with Collections, and needs more work to get the Yaml right. Refer t=
o the artefacts download link in
 this article to view the Yaml that was created for the scenario in this bl=
og post]<o:p></o:p></p>
<p>[Note: For simplicity in this article, I have considered the option prov=
ided by Functions to add the API key in the Request URL, under the key 'cod=
e'.&nbsp; For more secure ways to deal with it, use Azure AD integration or=
 other options]<o:p></o:p></p>
<p>After the Yaml is created and the definition is complete, test the reque=
sts from the Test console on the Web Page, and ensure that the Functions wo=
rk without errors. Once tested, click on the button 'Export to Power Apps a=
nd Flow' to export the Swagger definition
 and create a Custom connector in the latter.<o:p></o:p></p>
<p>5. Create a new custom Connection in powerapps.microsoft.com from the co=
nnector registered in the previous step. Embed the Security code for the Fu=
nction App. This gets stored with the connection and automatically included=
 in the request by Powerapps to
 the REST Services deployed on Azure Functions.<o:p></o:p></p>
<p><a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3=
A%2F%2Fmsdnshared.blob.core.windows.net%2Fmedia%2F2017%2F07%2FPowerapps-Cus=
tom-connection1.jpg&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a=
3%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636696883781245049&amp;sdata=
=3DZ0iFR9XMjnsV%2BrS2eF2ngENzsOe4ODWO16E%2B%2FJ4xt%2BE%3D&amp;reserved=3D0"=
 originalsrc=3D"https://msdnshared.blob.core.windows.net/media/2017/07/Powe=
rapps-Custom-connection1.jpg" shash=3D"Hu7iZGDpTUzDfT2UEjOO&#43;c3xPiAKZJQZ=
Q/07kTvLWRFhig6zmXpqxlNY8jAgkFAhEA7EOgyZBMTrXdk/ByRPlc&#43;IP7TGGIrOpAc0/bb=
3Q6j9EJx97nEHVkuMxXUzJIGhq/FhC49JbB7Ou40YNhNMDrs0KRt/C7KcC6k&#43;GgnzShA=3D=
"><span style=3D"text-decoration:none"><img border=3D"0" width=3D"2736" hei=
ght=3D"1080" style=3D"width:28.5in;height:11.25in" id=3D"_x0000_i1032" src=
=3D"https://msdnshared.blob.core.windows.net/media/2017/07/Powerapps-Custom=
-connection1.jpg"></span></a><o:p></o:p></p>
<p>6. Create a new Powerapps App that would consume the REST Services expos=
ed by Azure Functions in the earlier steps<o:p></o:p></p>
<p>While you could start with a blank Template, it involves some work to cr=
eate the different Forms required in the App for 'Display All', 'Edit' and =
'Browse All' use cases. Powerapps supports the ability to automatically gen=
erate all these Forms and provide
 a complete App, when selecting a Data Source like OneDrive, SharePoint Off=
ice 365 Lists, and many others. Since the 'ProjExpensesAPI' Connector we ha=
ve created is a custom one, this Wizard is not available to create the App =
automatically.<o:p></o:p></p>
<p>To work around this, I have created a Custom List in Office 365, that ha=
s the same fields as in the Expense data returned by the Function App. I us=
ed the wizard to generate a complete App based on the Custom List in Office=
 365, and then changed all the Data
 Source references from it to the 'ProjExpensesAPI' Connection.<o:p></o:p><=
/p>
<p><a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3=
A%2F%2Fmsdnshared.blob.core.windows.net%2Fmedia%2F2017%2F07%2Fpowerapps-scr=
een11.jpg&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C84df9e=
7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636696883781245049&amp;sdata=3DbFnrgG7=
37r%2BwX0IyuWz5Zl7jlTVIxQ5yf4BkgRwxi8Q%3D&amp;reserved=3D0" originalsrc=3D"=
https://msdnshared.blob.core.windows.net/media/2017/07/powerapps-screen11.j=
pg" shash=3D"Q4PLJkJEHTIeq4vEOFs3936O&#43;RHNEXD5XtuY693NgOox4a7OqaySKpOrEL=
peBZDEJGe63fpkCbVn5xSw6Mzv0kbk8J7YhzqwtG0k&#43;72fOG6fTRscZfbfOVGkwAaofMJfK=
cQWtPUXD64rVIh2&#43;7JEix/&#43;ThUiiobaGxOtk427Dsc=3D"><span style=3D"text-=
decoration:none"><img border=3D"0" width=3D"2736" height=3D"1666" style=3D"=
width:28.5in;height:17.3541in" id=3D"_x0000_i1033" src=3D"https://msdnshare=
d.blob.core.windows.net/media/2017/07/powerapps-screen11.jpg"></span></a><o=
:p></o:p></p>
<p>&nbsp;<o:p></o:p></p>
<p>Note in the screenshot above, how the Logged in User context can be pass=
ed through 'Excel like' functions to the Search Box. The data is filtered a=
fter it is received from the REST APIs. Notice how our custom API is invoke=
d below, and the data returned is
 filtered using the expression shown<o:p></o:p></p>
<p><a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3=
A%2F%2Fmsdnshared.blob.core.windows.net%2Fmedia%2F2017%2F07%2FPOWERAPPS2.jp=
g&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C84df9e7fe9f640=
afb435aaaaaaaaaaaa%7C1%7C0%7C636696883781245049&amp;sdata=3DheM%2BXpvFwcvSw=
txI9NMOkYWeXESFnD%2FGB64fym84pN0%3D&amp;reserved=3D0" originalsrc=3D"https:=
//msdnshared.blob.core.windows.net/media/2017/07/POWERAPPS2.jpg" shash=3D"m=
ce80LQT7rz3ltakoGVquAJtooA/5BvxqWhW1&#43;TgQhIhyi6jQz&#43;rsEFqBl0Bh&#43;VI=
m/Us6gmGA8lhs0&#43;R5BRDmD8oMPrBORLrCGZVwVxb/ADeCKpyuCZ9ZMGs1GpGKfahVwhUavz=
ptQnKsfb2n/NZPp/myL03jrb4tzVmjX7aQiM=3D"><span style=3D"text-decoration:non=
e"><img border=3D"0" width=3D"2243" height=3D"511" style=3D"width:23.3645in=
;height:5.3229in" id=3D"_x0000_i1034" src=3D"https://msdnshared.blob.core.w=
indows.net/media/2017/07/POWERAPPS2.jpg"></span></a><o:p></o:p></p>
<p>The screen shots of the App with each of the Forms is shown below. This =
App can be run on any of Windows, Android or iOS Mobile Devices.<o:p></o:p>=
</p>
<p><a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3=
A%2F%2Fmsdnshared.blob.core.windows.net%2Fmedia%2F2017%2F07%2Fpowerappimage=
1.jpg&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C84df9e7fe9=
f640afb435aaaaaaaaaaaa%7C1%7C0%7C636696883781245049&amp;sdata=3D8EoS3niBNGr=
Q%2B7jCi1VprhvFmrMFGFkBlrWRZC%2B%2Fb6U%3D&amp;reserved=3D0" originalsrc=3D"=
https://msdnshared.blob.core.windows.net/media/2017/07/powerappimage1.jpg" =
shash=3D"q4srhsfAMnvJQRzzXv3Vyse9mZ8RWR7GU3aK4gIo7jxHE&#43;9&#43;1LHXcu/koV=
qiBkVObMdrAvzjO&#43;IORb/jn9BgyGnlzEiphunvEsFy4yTOQTzO75o8LH/hBihsjVlHeeqKb=
S3sfk91iTwZhgY7u5gz3gFHJKWqmF8iyt3kAv6iWMA=3D"><span style=3D"text-decorati=
on:none"><img border=3D"0" width=3D"1280" height=3D"720" style=3D"width:13.=
3333in;height:7.5in" id=3D"_x0000_i1035" src=3D"https://msdnshared.blob.cor=
e.windows.net/media/2017/07/powerappimage1.jpg"></span></a><o:p></o:p></p>
<p>Test the App to ensure that all the REST API operations like GetAllExpen=
ses and CreateProjectExpense requests work from the App. It can then be pub=
lished by the user and shared with others in the Organization.<o:p></o:p></=
p>
<p>The powerapps App file is also provided along with the other artefacts i=
n this article.<o:p></o:p></p>
<p>&nbsp;<o:p></o:p></p>
</td>
</tr>
</tbody>
</table>
<p><br>
<a href=3D"https://eur01.safelinks.protection.outlook.com/?url=3Dhttps%3A%2=
F%2Fblogs.msdn.microsoft.com%2Fsrikantan%2F2017%2F07%2F22%2Fusing-azure-fun=
ctions-cosmos-db-and-powerapps-to-build-deploy-and-consume-serverless-apps%=
2F&amp;data=3D02%7C01%7C%7Cd28778285a4f4951a1ad08d6007142a3%7C84df9e7fe9f64=
0afb435aaaaaaaaaaaa%7C1%7C0%7C636696883781245049&amp;sdata=3DtwsGSMP4Az78WL=
fZEHa63NtZdf2qCU3zHZT3KPhTEIo%3D&amp;reserved=3D0" originalsrc=3D"https://b=
logs.msdn.microsoft.com/srikantan/2017/07/22/using-azure-functions-cosmos-d=
b-and-powerapps-to-build-deploy-and-consume-serverless-apps/" shash=3D"yfvs=
YnvA&#43;irRHdNGBBoEFmg2BEygnQNxWfgMhRKvwmrO3lkG1kt2E3fPqsjbyeOISGTdNtyf9&#=
43;UDk68GdtZpFeist005RLpbmXsDa67uSNJOi0WuHvCGzpeVhoXBjriLAIcpB7P&#43;OBz&#4=
3;A7OxcQfmTvCu0vaxYsUTyoHRndyOxzU=3D">View
 article...</a><o:p></o:p></p>
</div>
</body>
</html>
